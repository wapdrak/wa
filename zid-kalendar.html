<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>≈Ωidovsk√Ω kalend√°≈ô - Local Independent Edition</title>
    <style>
        /**
         * DESIGN: Fialov√Ω styl a scannabilita [cite: 2025-09-15]
         */
        :root {
            --bg: #0f0a1a;
            --card: #2e1a47; 
            --accent: #bb86fc;
            --text: #ffffff;
            --muted: #d1c4e9;
        }
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 15px;
        }
        #q-cont {
            width: 100%;
            max-width: 550px;
            background: var(--card);
            border: 3px solid var(--accent);
            border-radius: 35px;
            padding: 35px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.7);
            text-align: center;
        }
        .header { font-size: 0.9em; letter-spacing: 3px; text-transform: uppercase; color: var(--accent); margin-bottom: 5px; }
        .time-display { font-size: 1.2em; font-weight: bold; color: var(--text); margin-bottom: 10px; }
        
        .misto-select {
            background: rgba(187, 134, 252, 0.1);
            color: var(--accent);
            border: 1px solid var(--accent);
            border-radius: 10px;
            padding: 10px;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 15px;
            cursor: pointer;
            outline: none;
            width: 100%;
        }
        .misto-select option { background: var(--card); color: var(--text); }

        .g-label { font-size: 1em; color: var(--muted); margin-bottom: 2px; }
        .gregorian-date { font-size: 1.3em; color: var(--text); margin-bottom: 15px; font-weight: 400; }
        .jom-tyden { font-size: 1.7em; font-weight: 300; margin-bottom: 20px; color: var(--accent); }
        .hebrew-date { font-size: clamp(1.8em, 8vw, 2.5em); font-weight: 800; margin: 10px 0; line-height: 1.1; }
        .hebrew-script { font-size: 1.8em; color: var(--accent); margin-bottom: 20px; font-family: 'Times New Roman', serif; }
        .section-label { font-size: 1.1em; color: var(--accent); font-weight: bold; margin-top: 25px; display: block; }
        .detail-text { font-size: 1.2em; line-height: 1.5; color: var(--muted); font-style: italic; margin-top: 5px; }
        .parasha-link { color: var(--accent); text-decoration: none; border-bottom: 1px dashed var(--accent); }
        .explanation { margin-top: 30px; padding: 20px; border: 1px solid rgba(187, 134, 252, 0.3); border-radius: 20px; color: var(--accent); font-size: 0.95em; line-height: 1.4; background: rgba(0,0,0,0.2); text-align: left; }
        #custom-msg { width: 100%; background: rgba(15, 10, 26, 0.5); border: 1px solid var(--accent); border-radius: 15px; color: white; padding: 12px; margin-top: 10px; resize: none; box-sizing: border-box; font-family: inherit; font-size: 1em; }
        .share-btn { margin-top: 25px; background: var(--accent); color: #0f0a1a; border: none; padding: 20px; border-radius: 50px; font-size: 1.2em; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; }
        .share-btn:active { transform: scale(0.98); opacity: 0.8; }
    </style>
</head>
<body>

    <div id="q-cont">
        <div class="header">≈Ωidovsk√Ω kalend√°≈ô</div>
        <div id="time-txt" class="time-display">00:00:00</div>
        
        <select id="misto-select" class="misto-select" onchange="handleLocationChange(this.value)">
            <option value="auto">üìç Moje poloha (podle prohl√≠≈æeƒçe)</option>
            <hr>
            <!-- Lokality dopl≈àuje skript -->
        </select>
        
        <div class="g-label">üìÖ Dnes je:</div>
        <div id="g-date-txt" class="gregorian-date">--. --. ----</div>
        
        <div id="jom-txt" class="jom-tyden">‚ú® Naƒç√≠t√°m...</div>
        
        <div id="h-date-txt" class="hebrew-date">üìú --. -- ----</div>
        <div id="h-script-txt" class="hebrew-script">-- ◊ë÷¥÷º◊©÷∞◊Å◊ë÷∏◊ò --</div>
        
        
        <div class="detail-text">
        <span class="section-label">üìñ Para≈°at Ha≈†avua:</span>
    <a href="https://www.sefaria.org.il/topics/torah-portions?sort=Relevance&tab=sources" target="_blank" class="parasha-link" id="parasha-txt">Naƒç√≠t√°m para≈°u...</a>
        </div>
        
        <span class="section-label">‚ú® Sv√°tek / Ud√°lost:</span>
        <div id="event-txt" class="detail-text">Hled√°m ud√°losti...</div>

        <span class="section-label">üïØÔ∏è Zapalov√°n√≠ sv√≠c√≠:</span>
        <div id="candles-txt" class="detail-text">--:--</div>
        
        <div class="explanation">
            Datum se mƒõn√≠ s v√Ωchodem prvn√≠ hvƒõzdy (Tzeit HaKochavim) v dan√© lokalitƒõ, tak≈æe nov√Ω den zaƒç√≠n√° ji≈æ veƒçer. Pokud pou≈æ√≠v√°te automatickou polohu, povolte pros√≠m p≈ô√≠stup k GPS.
        </div>

        <textarea id="custom-msg" rows="2">Pos√≠l√°m pozdravy! üáÆüá±üá®üáøüá∏üá∞</textarea>
        <button class="share-btn" onclick="shareJewishDay()">Sd√≠let datum</button>
    </div>

    <script>
        /**
         * 1. KONFIGURACE
         */
        const LOKALITY = {
            "Haifa":      { lat: 32.79, lng: 34.99, tz: 120, label: "Haifa, Izrael üáÆüá±" },
            "Jeruzalem":  { lat: 31.76, lng: 35.21, tz: 120, label: "Jeruzal√©m, Izrael üáÆüá±" },
            "Praha":      { lat: 50.07, lng: 14.43, tz: 60,  label: "Praha, ƒåesko üá®üáø" },
            "Bratislava": { lat: 48.14, lng: 17.10, tz: 60,  label: "Bratislava, Slovensko üá∏üá∞" },
            "Chicago":    { lat: 41.87, lng: -87.62, tz: -360, label: "Chicago, USA üá∫üá∏" },
            "NewYork":    { lat: 40.71, lng: -74.00, tz: -300, label: "New York, USA üá∫üá∏" },
            "CedarRapids": { lat: 41.97, lng: -91.66, tz: -360, label: "Cedar Rapids, USA üá∫üá∏" },
            "London":     { lat: 51.50, lng: -0.12, tz: 0,   label: "Lond√Ωn, Brit√°nie üá¨üáß" },
            "Munchen":    { lat: 48.13, lng: 11.58, tz: 60,  label: "Mnichov, Nƒõmecko üá©üá™" },
            "Wien":       { lat: 48.20, lng: 16.37, tz: 60,  label: "V√≠de≈à, Rakousko üá¶üáπ" },
            "Toronto":    { lat: 43.65, lng: -79.38, tz: -300, label: "Toronto, Kanada üá®üá¶" },
            "Melbourne":  { lat: -37.81, lng: 144.96, tz: 660, label: "Melbourne, Austr√°lie üá¶üá∫" }
        };

        const dnyPhonetic = ["Jom ri≈°on (Nedƒõle)", "Jom ≈°eni (Pondƒõl√≠)", "Jom ≈°li≈°i (√öter√Ω)", "Jom revi'i (St≈ôeda)", "Jom chami≈°i (ƒåtvrtek)", "Jom ≈°i≈°i (P√°tek)", "≈†abat (Sobota)"];
        const mesHeCz = {"Shevat":"≈†vat", "Adar I":"Adar I", "Adar II":"Adar II", "Nisan":"Nisan", "Iyar":"Ijar", "Sivan":"Sivan", "Tamuz":"Tamuz", "Av":"Av", "Elul":"Elul", "Tishri":"Ti≈°rej", "Cheshvan":"Che≈°van", "Kislev":"Kislev", "Tevet":"Tevet"};
        const capitalize = (s) => s.charAt(0).toUpperCase() + s.slice(1);

        let clockInterval = null;
        let currentConf = null;

        /**
         * 2. V√ùPOƒåTY (Slunce a poloha)
         */
        function getSunsetLocal(date, conf) {
            const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 86400000);
            const latRad = conf.lat * Math.PI / 180;
            const decl = 0.409 * Math.sin(2 * Math.PI * (dayOfYear - 81) / 365);
            const cosH = -Math.tan(latRad) * Math.tan(decl);
            if (cosH > 1) return -1; 
            if (cosH < -1) return 1440; 
            const hAngle = Math.acos(cosH) * 180 / Math.PI / 15;
            const b = (2 * Math.PI * (dayOfYear - 81)) / 365;
            const eot = 9.87 * Math.sin(2 * b) - 7.53 * Math.cos(b) - 1.5 * Math.sin(b);
            const solarSunset = 12 + hAngle;
            const utcSunset = solarSunset - (conf.lng / 15) - (eot / 60);
            
            // Pro automatickou polohu pou≈æijeme offset prohl√≠≈æeƒçe
            const offset = (conf.isAuto) ? -date.getTimezoneOffset() : conf.tz + (isTargetInDST(date) ? 60 : 0);
            return (utcSunset * 60) + offset;
        }

        function isTargetInDST(date) {
            const m = date.getMonth();
            return (m > 2 && m < 9); 
        }

        /**
         * 3. LOGIKA SV√ÅTK≈Æ
         */
        function getHoliday(hDay, hMonth, dayOfWeek) {
            const m = hMonth;
            const d = hDay;
            if (m === "Tishri" && d === 1) return "Ro≈° ha-≈°ana (Nov√Ω rok)";
            if (m === "Tishri" && d === 2) return "Ro≈° ha-≈°ana 2. den";
            if (m === "Tishri" && d === 10) return "Jom kipur (Den sm√≠≈ôen√≠)";
            if (m === "Tishri" && d >= 15 && d <= 21) return "Sukot (Sv√°tek st√°nk≈Ø)";
            if (m === "Tishri" && d === 22) return "≈†mini aceret / Simchat T√≥ra";
            if (m === "Kislev" && d === 25) return "Chanuka (1. sv√≠ƒçka veƒçer)";
            if (m === "Tevet" && d <= 2) return "Chanuka";
            if (m === "Shevat" && d === 15) return "Tu bi-≈°vat (Nov√Ω rok strom≈Ø)";
            if ((m === "Adar" || m === "Adar II") && d === 14) return "Purim";
            if (m === "Nisan" && d >= 15 && d <= 22) return "Pesach";
            if (m === "Iyar" && d === 18) return "Lag ba-omer";
            if (m === "Sivan" && d === 6) return "≈†avuot";
            if (m === "Av" && d === 9) return "Ti≈°a be-av (P≈Øst)";
            if (dayOfWeek === 6) return "≈†abat (Svat√Ω odpoƒçinku)";
            return "Dnes nen√≠ ≈æ√°dn√Ω v√Ωznamn√Ω sv√°tek.";
        }

        /**
         * 4. HLAVN√ç FUNKCE
         */
        function handleLocationChange(val) {
            if (val === "auto") {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (pos) => {
                            const autoConf = {
                                lat: pos.coords.latitude,
                                lng: pos.coords.longitude,
                                tz: -new Date().getTimezoneOffset(),
                                label: "Moje poloha (üìç detekov√°no)",
                                isAuto: true
                            };
                            updateDashboard(autoConf);
                        },
                        () => {
                            alert("Nepoda≈ôilo se z√≠skat polohu. P≈ôep√≠n√°m na Haifu.");
                            updateDashboard(LOKALITY["Haifa"]);
                        }
                    );
                } else {
                    alert("V√°≈° prohl√≠≈æeƒç nepodporuje geolokaci.");
                    updateDashboard(LOKALITY["Haifa"]);
                }
            } else {
                updateDashboard(LOKALITY[val]);
            }
        }

        function updateDashboard(conf) {
            currentConf = conf;
            const select = document.getElementById('misto-select');
            
            // Hodiny
            if (clockInterval) clearInterval(clockInterval);
            const updateLocalClock = () => {
                const now = new Date();
                if (conf.isAuto) {
                    document.getElementById('time-txt').innerText = now.toLocaleTimeString('cs-CZ');
                } else {
                    const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
                    const isDST = isTargetInDST(now);
                    const localTime = new Date(utc + (conf.tz + (isDST ? 60 : 0)) * 60000);
                    document.getElementById('time-txt').innerText = localTime.toLocaleTimeString('cs-CZ');
                }
            };
            updateLocalClock();
            clockInterval = setInterval(updateLocalClock, 1000);

            // V√Ωpoƒçet ≈Ωidovsk√©ho data
            const now = new Date();
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const targetNow = (conf.isAuto) ? now : new Date(utc + (conf.tz + (isTargetInDST(now) ? 60 : 0)) * 60000);

            let d_zid = new Date(targetNow);
            const sunsetMin = getSunsetLocal(targetNow, conf);
            const tzeitMin = sunsetMin + 35; // Tzeit HaKochavim (v√Ωchod hvƒõzd)
            const nyniMin = (targetNow.getHours() * 60) + targetNow.getMinutes();

            // P≈òEKLOPEN√ç DATA
            if (nyniMin >= tzeitMin) {
                d_zid.setDate(d_zid.getDate() + 1);
            }

            // UI V√Ωstupy
            document.getElementById('g-date-txt').innerText = capitalize(targetNow.toLocaleDateString('cs-CZ', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' }));
            document.getElementById('jom-txt').innerText = "‚ú® " + dnyPhonetic[d_zid.getDay()];

            // Intl Hebrew API
            const hFormat = new Intl.DateTimeFormat('en-u-ca-hebrew', {day:'numeric', month:'long', year:'numeric'});
            const hParts = hFormat.formatToParts(d_zid);
            const hScript = new Intl.DateTimeFormat('he-u-ca-hebrew', {day:'numeric', month:'long', year:'numeric'}).format(d_zid);
            
            let hDen, hMesEn, hRok;
            hParts.forEach(p => {
                if (p.type === 'day') hDen = parseInt(p.value);
                if (p.type === 'month') hMesEn = p.value;
                if (p.type === 'year') hRok = p.value;
            });

            document.getElementById('h-date-txt').innerText = `üìú ${hDen}. ${mesHeCz[hMesEn] || hMesEn} ${hRok}`;
            document.getElementById('h-script-txt').innerText = hScript;
            document.getElementById('event-txt').innerText = getHoliday(hDen, hMesEn, d_zid.getDay());

            // Zapalov√°n√≠ sv√≠c√≠ (p√°tek)
            if (targetNow.getDay() === 5) {
                const candleMin = sunsetMin - 18;
                const h = Math.floor(candleMin / 60);
                const m = Math.floor(candleMin % 60);
                document.getElementById('candles-txt').innerText = `${h}:${m < 10 ? '0'+m : m}`;
            } else {
                document.getElementById('candles-txt').innerText = "Dnes se nesv√≠t√≠.";
            }

            // Para≈°a
            const vsechnyParashot = ["Bere≈°it", "Noach", "Lech Lecha", "Vajera", "Chajej S√°ra", "Toledot", "Vajece", "Vaji≈°lach", "Vaje≈°ev", "Mikec", "Vajiga≈°", "Vajechi", "≈†emot", "Va'era", "Bo", "Be≈°alach", "Jitro", "Mi≈°patim", "Teruma", "Tecave", "Ki tisa", "Vajakhel", "Pekudej", "Vajikra", "Caw", "≈†mini", "Tazria", "Mecora", "Acharej Mot", "Kedo≈°im", "Emor", "Behar", "Bechukotaj", "Bemidbar", "Naso", "Beha'alotecha", "≈†lach Lecha", "Korach", "Chukat", "Balak", "Pinchas", "Matot", "Masej", "Devarim", "Va'etchanan", "Ekev", "Re'e", "Shoftim", "Ki tece", "Ki tavo", "Nicavim", "Vajelech", "Ha'azinu", "Ve-zot ha-beracha"];
            let sabat = new Date(d_zid);
            while (sabat.getDay() !== 6) sabat.setDate(sabat.getDate() + 1);
            const startRoku = new Date(d_zid.getFullYear(), 0, 1);
            const tydenRoku = Math.ceil((((sabat - startRoku) / 86400000) + startRoku.getDay() + 1) / 7);
            document.getElementById('parasha-txt').innerText = vsechnyParashot[(tydenRoku + 13) % vsechnyParashot.length];
        }

        /**
         * 5. SD√çLEN√ç
         */
        function shareJewishDay() {
            if (!currentConf) return;
            const text = `≈Ωidovsk√Ω kalend√°≈ô\n\n` +
                         `üìç ${currentConf.label}\n\n` +
                         `üïí ƒåas: ${document.getElementById('time-txt').innerText}\n` +
                         `üìÖ Dnes je:\n\n` +
                         `${document.getElementById('g-date-txt').innerText}\n` +
                         `${document.getElementById('jom-txt').innerText}\n\n` +
                         `${document.getElementById('h-date-txt').innerText}\n` +
                         `${document.getElementById('h-script-txt').innerText}\n\n` +
                         `üìñ Para≈°a: ${document.getElementById('parasha-txt').innerText}\n` +
                         `‚ú® Sv√°tek: ${document.getElementById('event-txt').innerText}\n` +
                         `üïØÔ∏è Sv√≠ce: ${document.getElementById('candles-txt').innerText}\n\n` +
                         `https://www.sefaria.org.il/topics/torah-portions\n\n` +
                         `Datum se mƒõn√≠ s v√Ωchodem prvn√≠ hvƒõzdy (Tzeit HaKochavim) v dan√© lokalitƒõ, tak≈æe nov√Ω den zaƒç√≠n√° ji≈æ veƒçer.\n\n` +
                         `üí¨ ${document.getElementById('custom-msg').value}`;

            if (navigator.share) {
                navigator.share({ text: text });
            } else {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert("Text zkop√≠rov√°n do schr√°nky.");
            }
        }

        window.onload = () => {
            const select = document.getElementById('misto-select');
            for (const key in LOKALITY) {
                const opt = document.createElement('option');
                opt.value = key;
                opt.innerText = LOKALITY[key].label;
                select.appendChild(opt);
            }
            handleLocationChange("auto"); // V√Ωchoz√≠: Automatick√° poloha
        };
    </script>
</body>
</html>